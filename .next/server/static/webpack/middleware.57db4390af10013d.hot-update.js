"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.js":
/*!***********************!*\
  !*** ./middleware.js ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/webapi/jwt/verify.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/next/dist/esm/api/headers.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\n\nconst JWT_SECRET = process.env.JWT_SECRET;\nconst ROLE_CLAIM = 'http://schemas.microsoft.com/ws/2008/06/identity/claims/role';\nconst VERIFIED_CLAIM = 'http://schemas.xmlsoap.org/ws/2009/09/identity/claims/actor';\nasync function verifyToken(token) {\n    try {\n        return await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(token, new TextEncoder().encode(JWT_SECRET));\n    } catch  {\n        return null;\n    }\n}\nfunction clearCookies(response, cookieNames) {\n    cookieNames.forEach((name)=>{\n        response.cookies.set(name, '', {\n            maxAge: 0,\n            path: '/',\n            httpOnly: true,\n            secure: true,\n            sameSite: 'Strict'\n        });\n    });\n}\nfunction applySecurityHeaders(response, nonce) {\n    const csp = `\n    default-src 'self';\n    script-src 'self' 'nonce-${nonce}';\n    style-src 'self' 'unsafe-inline';\n    img-src 'self' data: blob:;\n    font-src 'self';\n    connect-src 'self';\n    frame-ancestors 'none';\n    object-src 'none';\n    base-uri 'self';\n    form-action 'self';\n    upgrade-insecure-requests;\n  `.replace(/\\s{2,}/g, ' ').trim();\n    response.headers.set('Content-Security-Policy', csp);\n    response.headers.set('X-Content-Type-Options', 'nosniff');\n    response.headers.set('X-Frame-Options', 'DENY');\n    response.headers.set('Strict-Transport-Security', 'max-age=63072000; includeSubDomains; preload');\n    response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n    response.headers.set('X-XSS-Protection', '1; mode=block');\n}\nasync function generateNonce() {\n    const array = new Uint8Array(16);\n    crypto__WEBPACK_IMPORTED_MODULE_2___default().getRandomValues(array);\n    return array.toString('base64');\n}\nasync function middleware(req) {\n    const url = new URL(req.url);\n    const pathname = url.pathname;\n    const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    const tokenCookie = cookieStore.get('token');\n    const otpTokenCookie = cookieStore.get('otp_token');\n    const resetTokenCookie = cookieStore.get('reset');\n    const tokensPresent = [\n        tokenCookie,\n        otpTokenCookie,\n        resetTokenCookie\n    ].filter(Boolean);\n    const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    // Inject security headers\n    const nonce = await generateNonce();\n    applySecurityHeaders(response, nonce);\n    if (tokensPresent.length > 1) {\n        clearCookies(response, [\n            'token',\n            'otp_token',\n            'reset'\n        ]);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/un/login', req.url));\n    }\n    const isAuthPage = [\n        '/un/login',\n        '/un/register'\n    ].some((path)=>pathname.startsWith(path));\n    const isOtpPage = pathname.startsWith('/un/otpValidatePassword');\n    const isResetPage = pathname.startsWith('/un/resetPassword');\n    const isConfirmEmailPage = pathname.startsWith('/User/VerifyEmail');\n    const isProtectedPage = pathname.startsWith('/User') || pathname.startsWith('/Admin');\n    async function verifyOrClear(token) {\n        if (!token) return null;\n        const decoded = await verifyToken(token.value);\n        if (!decoded) {\n            clearCookies(response, [\n                'token',\n                'otp_token',\n                'reset'\n            ]);\n            return null;\n        }\n        return decoded;\n    }\n    if (isOtpPage) {\n        const decoded = await verifyOrClear(otpTokenCookie);\n        if (!decoded) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/un/login', req.url));\n        return response;\n    }\n    if (isResetPage) {\n        const decoded = await verifyOrClear(resetTokenCookie);\n        if (!decoded) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/un/login', req.url));\n        return response;\n    }\n    if (isAuthPage) {\n        clearCookies(response, [\n            'otp_token',\n            'reset'\n        ]);\n        if (tokenCookie) {\n            const decoded = await verifyOrClear(tokenCookie);\n            if (!decoded) return response;\n            const roles = decoded.payload[ROLE_CLAIM] || [];\n            const role = Array.isArray(roles) ? roles[0] : roles;\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`/${role}/dashboard`, req.url));\n        }\n        return response;\n    }\n    if (isProtectedPage) {\n        const decoded = await verifyOrClear(tokenCookie);\n        if (!decoded) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/un/login', req.url));\n        const roles = decoded.payload[ROLE_CLAIM] || [];\n        const role = Array.isArray(roles) ? roles[0] : roles;\n        if (isConfirmEmailPage) {\n            const isVerified = decoded.payload[VERIFIED_CLAIM];\n            if (isVerified === 'True') {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`/${role}/dashboard`, req.url));\n            }\n            return response;\n        }\n        if (pathname.startsWith('/Admin') && role !== 'Admin' || pathname.startsWith('/User') && role !== 'User') {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`/${role}/dashboard`, req.url));\n        }\n        return response;\n    }\n    return response;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNd0IsUUFBUUYsUUFBUUcsT0FBTyxDQUFDdkQsV0FBVyxJQUFJLEVBQUU7UUFDL0MsTUFBTXdELE9BQU9DLE1BQU1DLE9BQU8sQ0FBQ0osU0FBU0EsS0FBSyxDQUFDLEVBQUUsR0FBR0E7UUFFL0MsSUFBSUwsb0JBQW9CO1lBQ3RCLE1BQU1VLGFBQWFQLFFBQVFHLE9BQU8sQ0FBQ3RELGVBQWU7WUFDbEQsSUFBSTBELGVBQWUsUUFBUTtnQkFDekIsT0FBT2xFLHFEQUFZQSxDQUFDa0QsUUFBUSxDQUFDLElBQUlaLElBQUksQ0FBQyxDQUFDLEVBQUV5QixLQUFLLFVBQVUsQ0FBQyxFQUFFM0IsSUFBSUMsR0FBRztZQUNwRTtZQUNBLE9BQU92QjtRQUNUO1FBRUEsSUFDRSxTQUFVdUMsVUFBVSxDQUFDLGFBQWFVLFNBQVMsV0FDMUN4QixTQUFTYyxVQUFVLENBQUMsWUFBWVUsU0FBUyxRQUMxQztZQUNBLE9BQU8vRCxxREFBWUEsQ0FBQ2tELFFBQVEsQ0FBQyxJQUFJWixJQUFJLENBQUMsQ0FBQyxFQUFFeUIsS0FBSyxVQUFVLENBQUMsRUFBRTNCLElBQUlDLEdBQUc7UUFDcEU7UUFFQSxPQUFPdkI7SUFDVDtJQUVBLE9BQU9BO0FBQ1QiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcTW9oYW1hZFxcT25lRHJpdmVcXERlc2t0b3BcXFJ1aGFuX05leHQrYXNwXFxydWhhblxcbWlkZGxld2FyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGp3dFZlcmlmeSB9IGZyb20gJ2pvc2UnO1xyXG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJztcclxuaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xyXG5cclxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQ7XHJcbmNvbnN0IFJPTEVfQ0xBSU0gPSAnaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlJztcclxuY29uc3QgVkVSSUZJRURfQ0xBSU0gPSAnaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwOS8wOS9pZGVudGl0eS9jbGFpbXMvYWN0b3InO1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5VG9rZW4odG9rZW4pIHtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIGF3YWl0IGp3dFZlcmlmeSh0b2tlbiwgbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKEpXVF9TRUNSRVQpKTtcclxuICB9IGNhdGNoIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2xlYXJDb29raWVzKHJlc3BvbnNlLCBjb29raWVOYW1lcykge1xyXG4gIGNvb2tpZU5hbWVzLmZvckVhY2gobmFtZSA9PiB7XHJcbiAgICByZXNwb25zZS5jb29raWVzLnNldChuYW1lLCAnJywge1xyXG4gICAgICBtYXhBZ2U6IDAsXHJcbiAgICAgIHBhdGg6ICcvJyxcclxuICAgICAgaHR0cE9ubHk6IHRydWUsXHJcbiAgICAgIHNlY3VyZTogdHJ1ZSxcclxuICAgICAgc2FtZVNpdGU6ICdTdHJpY3QnLFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFwcGx5U2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlLCBub25jZSkge1xyXG4gIGNvbnN0IGNzcCA9IGBcclxuICAgIGRlZmF1bHQtc3JjICdzZWxmJztcclxuICAgIHNjcmlwdC1zcmMgJ3NlbGYnICdub25jZS0ke25vbmNlfSc7XHJcbiAgICBzdHlsZS1zcmMgJ3NlbGYnICd1bnNhZmUtaW5saW5lJztcclxuICAgIGltZy1zcmMgJ3NlbGYnIGRhdGE6IGJsb2I6O1xyXG4gICAgZm9udC1zcmMgJ3NlbGYnO1xyXG4gICAgY29ubmVjdC1zcmMgJ3NlbGYnO1xyXG4gICAgZnJhbWUtYW5jZXN0b3JzICdub25lJztcclxuICAgIG9iamVjdC1zcmMgJ25vbmUnO1xyXG4gICAgYmFzZS11cmkgJ3NlbGYnO1xyXG4gICAgZm9ybS1hY3Rpb24gJ3NlbGYnO1xyXG4gICAgdXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cztcclxuICBgLnJlcGxhY2UoL1xcc3syLH0vZywgJyAnKS50cmltKCk7XHJcblxyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdDb250ZW50LVNlY3VyaXR5LVBvbGljeScsIGNzcCk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtQ29udGVudC1UeXBlLU9wdGlvbnMnLCAnbm9zbmlmZicpO1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLUZyYW1lLU9wdGlvbnMnLCAnREVOWScpO1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5JywgJ21heC1hZ2U9NjMwNzIwMDA7IGluY2x1ZGVTdWJEb21haW5zOyBwcmVsb2FkJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1JlZmVycmVyLVBvbGljeScsICdzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtWFNTLVByb3RlY3Rpb24nLCAnMTsgbW9kZT1ibG9jaycpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlTm9uY2UoKSB7XHJcbiAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheSgxNik7XHJcbiAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhhcnJheSk7XHJcbiAgcmV0dXJuIGFycmF5LnRvU3RyaW5nKCdiYXNlNjQnKTtcclxufVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXEpIHtcclxuICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcS51cmwpO1xyXG4gIGNvbnN0IHBhdGhuYW1lID0gdXJsLnBhdGhuYW1lO1xyXG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gY29va2llcygpO1xyXG4gIGNvbnN0IHRva2VuQ29va2llID0gY29va2llU3RvcmUuZ2V0KCd0b2tlbicpO1xyXG4gIGNvbnN0IG90cFRva2VuQ29va2llID0gY29va2llU3RvcmUuZ2V0KCdvdHBfdG9rZW4nKTtcclxuICBjb25zdCByZXNldFRva2VuQ29va2llID0gY29va2llU3RvcmUuZ2V0KCdyZXNldCcpO1xyXG5cclxuICBjb25zdCB0b2tlbnNQcmVzZW50ID0gW3Rva2VuQ29va2llLCBvdHBUb2tlbkNvb2tpZSwgcmVzZXRUb2tlbkNvb2tpZV0uZmlsdGVyKEJvb2xlYW4pO1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuXHJcbiAgLy8gSW5qZWN0IHNlY3VyaXR5IGhlYWRlcnNcclxuICBjb25zdCBub25jZSA9IGF3YWl0IGdlbmVyYXRlTm9uY2UoKTtcclxuICBhcHBseVNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSwgbm9uY2UpO1xyXG5cclxuICBpZiAodG9rZW5zUHJlc2VudC5sZW5ndGggPiAxKSB7XHJcbiAgICBjbGVhckNvb2tpZXMocmVzcG9uc2UsIFsndG9rZW4nLCAnb3RwX3Rva2VuJywgJ3Jlc2V0J10pO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvdW4vbG9naW4nLCByZXEudXJsKSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBpc0F1dGhQYWdlID0gWycvdW4vbG9naW4nLCAnL3VuL3JlZ2lzdGVyJ10uc29tZShwYXRoID0+IHBhdGhuYW1lLnN0YXJ0c1dpdGgocGF0aCkpO1xyXG4gIGNvbnN0IGlzT3RwUGFnZSA9IHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy91bi9vdHBWYWxpZGF0ZVBhc3N3b3JkJyk7XHJcbiAgY29uc3QgaXNSZXNldFBhZ2UgPSBwYXRobmFtZS5zdGFydHNXaXRoKCcvdW4vcmVzZXRQYXNzd29yZCcpO1xyXG4gIGNvbnN0IGlzQ29uZmlybUVtYWlsUGFnZSA9IHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9Vc2VyL1ZlcmlmeUVtYWlsJyk7XHJcbiAgY29uc3QgaXNQcm90ZWN0ZWRQYWdlID0gcGF0aG5hbWUuc3RhcnRzV2l0aCgnL1VzZXInKSB8fCBwYXRobmFtZS5zdGFydHNXaXRoKCcvQWRtaW4nKTtcclxuXHJcbiAgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5T3JDbGVhcih0b2tlbikge1xyXG4gICAgaWYgKCF0b2tlbikgcmV0dXJuIG51bGw7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgdmVyaWZ5VG9rZW4odG9rZW4udmFsdWUpO1xyXG4gICAgaWYgKCFkZWNvZGVkKSB7XHJcbiAgICAgIGNsZWFyQ29va2llcyhyZXNwb25zZSwgWyd0b2tlbicsICdvdHBfdG9rZW4nLCAncmVzZXQnXSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRlY29kZWQ7XHJcbiAgfVxyXG5cclxuICBpZiAoaXNPdHBQYWdlKSB7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgdmVyaWZ5T3JDbGVhcihvdHBUb2tlbkNvb2tpZSk7XHJcbiAgICBpZiAoIWRlY29kZWQpIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL3VuL2xvZ2luJywgcmVxLnVybCkpO1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gIH1cclxuXHJcbiAgaWYgKGlzUmVzZXRQYWdlKSB7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgdmVyaWZ5T3JDbGVhcihyZXNldFRva2VuQ29va2llKTtcclxuICAgIGlmICghZGVjb2RlZCkgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvdW4vbG9naW4nLCByZXEudXJsKSk7XHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICBpZiAoaXNBdXRoUGFnZSkge1xyXG4gICAgY2xlYXJDb29raWVzKHJlc3BvbnNlLCBbJ290cF90b2tlbicsICdyZXNldCddKTtcclxuICAgIGlmICh0b2tlbkNvb2tpZSkge1xyXG4gICAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgdmVyaWZ5T3JDbGVhcih0b2tlbkNvb2tpZSk7XHJcbiAgICAgIGlmICghZGVjb2RlZCkgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgICBjb25zdCByb2xlcyA9IGRlY29kZWQucGF5bG9hZFtST0xFX0NMQUlNXSB8fCBbXTtcclxuICAgICAgY29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkocm9sZXMpID8gcm9sZXNbMF0gOiByb2xlcztcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKGAvJHtyb2xlfS9kYXNoYm9hcmRgLCByZXEudXJsKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICBpZiAoaXNQcm90ZWN0ZWRQYWdlKSB7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgdmVyaWZ5T3JDbGVhcih0b2tlbkNvb2tpZSk7XHJcbiAgICBpZiAoIWRlY29kZWQpIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL3VuL2xvZ2luJywgcmVxLnVybCkpO1xyXG5cclxuICAgIGNvbnN0IHJvbGVzID0gZGVjb2RlZC5wYXlsb2FkW1JPTEVfQ0xBSU1dIHx8IFtdO1xyXG4gICAgY29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkocm9sZXMpID8gcm9sZXNbMF0gOiByb2xlcztcclxuXHJcbiAgICBpZiAoaXNDb25maXJtRW1haWxQYWdlKSB7XHJcbiAgICAgIGNvbnN0IGlzVmVyaWZpZWQgPSBkZWNvZGVkLnBheWxvYWRbVkVSSUZJRURfQ0xBSU1dO1xyXG4gICAgICBpZiAoaXNWZXJpZmllZCA9PT0gJ1RydWUnKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKGAvJHtyb2xlfS9kYXNoYm9hcmRgLCByZXEudXJsKSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChcclxuICAgICAgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9BZG1pbicpICYmIHJvbGUgIT09ICdBZG1pbicpIHx8XHJcbiAgICAgIChwYXRobmFtZS5zdGFydHNXaXRoKCcvVXNlcicpICYmIHJvbGUgIT09ICdVc2VyJylcclxuICAgICkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoYC8ke3JvbGV9L2Rhc2hib2FyZGAsIHJlcS51cmwpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzcG9uc2U7XHJcbn1cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImp3dFZlcmlmeSIsImNvb2tpZXMiLCJjcnlwdG8iLCJKV1RfU0VDUkVUIiwicHJvY2VzcyIsImVudiIsIlJPTEVfQ0xBSU0iLCJWRVJJRklFRF9DTEFJTSIsInZlcmlmeVRva2VuIiwidG9rZW4iLCJUZXh0RW5jb2RlciIsImVuY29kZSIsImNsZWFyQ29va2llcyIsInJlc3BvbnNlIiwiY29va2llTmFtZXMiLCJmb3JFYWNoIiwibmFtZSIsInNldCIsIm1heEFnZSIsInBhdGgiLCJodHRwT25seSIsInNlY3VyZSIsInNhbWVTaXRlIiwiYXBwbHlTZWN1cml0eUhlYWRlcnMiLCJub25jZSIsImNzcCIsInJlcGxhY2UiLCJ0cmltIiwiaGVhZGVycyIsImdlbmVyYXRlTm9uY2UiLCJhcnJheSIsIlVpbnQ4QXJyYXkiLCJnZXRSYW5kb21WYWx1ZXMiLCJ0b1N0cmluZyIsIm1pZGRsZXdhcmUiLCJyZXEiLCJ1cmwiLCJVUkwiLCJwYXRobmFtZSIsImNvb2tpZVN0b3JlIiwidG9rZW5Db29raWUiLCJnZXQiLCJvdHBUb2tlbkNvb2tpZSIsInJlc2V0VG9rZW5Db29raWUiLCJ0b2tlbnNQcmVzZW50IiwiZmlsdGVyIiwiQm9vbGVhbiIsIm5leHQiLCJsZW5ndGgiLCJyZWRpcmVjdCIsImlzQXV0aFBhZ2UiLCJzb21lIiwic3RhcnRzV2l0aCIsImlzT3RwUGFnZSIsImlzUmVzZXRQYWdlIiwiaXNDb25maXJtRW1haWxQYWdlIiwiaXNQcm90ZWN0ZWRQYWdlIiwidmVyaWZ5T3JDbGVhciIsImRlY29kZWQiLCJ2YWx1ZSIsInJvbGVzIiwicGF5bG9hZCIsInJvbGUiLCJBcnJheSIsImlzQXJyYXkiLCJpc1ZlcmlmaWVkIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./middleware.js\n");

/***/ })

});