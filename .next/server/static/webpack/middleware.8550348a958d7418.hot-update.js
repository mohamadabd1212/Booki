"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.js":
/*!***********************!*\
  !*** ./middleware.js ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/webapi/jwt/verify.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/next/dist/esm/api/headers.js\");\n\n\n\n// Constants\nconst JWT_SECRET = process.env.JWT_SECRET;\nconst ROLE_CLAIM = 'http://schemas.microsoft.com/ws/2008/06/identity/claims/role';\nconst VERIFIED_CLAIM = 'http://schemas.xmlsoap.org/ws/2009/09/identity/claims/actor';\n// Function to verify the JWT token\nasync function verifyToken(token) {\n    try {\n        return await (0,jose__WEBPACK_IMPORTED_MODULE_2__.jwtVerify)(token, new TextEncoder().encode(JWT_SECRET));\n    } catch  {\n        return null;\n    }\n}\n// Function to clear cookies\nfunction clearCookies(response, cookieNames) {\n    cookieNames.forEach((name)=>response.cookies.set(name, '', {\n            maxAge: 0,\n            path: '/',\n            httpOnly: true,\n            secure: \"development\" === 'production',\n            sameSite: 'Strict'\n        }));\n}\n// Function to generate nonce for CSP (Content Security Policy)\nfunction generateNonce() {\n    const array = new Uint8Array(16);\n    crypto.getRandomValues(array);\n    return array.toString('base64');\n}\n// Function to apply security headers\nfunction applySecurityHeaders(response, nonce) {\n    const csp = `\n    default-src 'self';\n    script-src 'self' 'nonce-${nonce}' 'unsafe-inline';\n    style-src 'self' 'unsafe-inline';\n    img-src 'self' data: blob:;\n    font-src 'self';\n    connect-src 'self';\n    frame-ancestors 'none';\n    object-src 'none';\n    base-uri 'self';\n    form-action 'self';\n    upgrade-insecure-requests;\n  `.replace(/\\s{2,}/g, ' ').trim();\n    response.headers.set('Content-Security-Policy', csp);\n    response.headers.set('X-Content-Type-Options', 'nosniff');\n    response.headers.set('X-Frame-Options', 'DENY');\n    response.headers.set('Strict-Transport-Security', 'max-age=63072000; includeSubDomains; preload');\n    response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n    response.headers.set('X-XSS-Protection', '1; mode=block');\n}\nasync function middleware(req) {\n    const pathname = req.nextUrl.pathname;\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    const tokenCookie = cookieStore.get('token');\n    const otpTokenCookie = cookieStore.get('otp_token');\n    const resetTokenCookie = cookieStore.get('reset');\n    const tokensPresent = [\n        tokenCookie,\n        otpTokenCookie,\n        resetTokenCookie\n    ].filter(Boolean);\n    const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    // Add security headers\n    const nonce = generateNonce(); // Generate a nonce for the CSP\n    applySecurityHeaders(response, nonce);\n    // Handle multiple tokens (clear if more than one token is present)\n    if (tokensPresent.length > 1) {\n        clearCookies(response, [\n            'token',\n            'otp_token',\n            'reset'\n        ]);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/un/login', req.url));\n    }\n    const isAuthPage = [\n        '/un/login',\n        '/un/register'\n    ].some((path)=>pathname.startsWith(path));\n    const isOtpPage = pathname.startsWith('/un/otpValidatePassword');\n    const isResetPage = pathname.startsWith('/un/resetPassword');\n    const isConfirmEmailPage = pathname.startsWith('/User/VerifyEmail');\n    const isProtectedPage = pathname.startsWith('/User') || pathname.startsWith('/Admin');\n    async function verifyOrClear(tokenCookie) {\n        if (!tokenCookie) return null;\n        const decoded = await verifyToken(tokenCookie.value);\n        if (!decoded) {\n            clearCookies(response, [\n                'token',\n                'otp_token',\n                'reset'\n            ]);\n            return null;\n        }\n        return decoded;\n    }\n    // OTP page requires valid otp_token\n    if (isOtpPage) {\n        const decoded = await verifyOrClear(otpTokenCookie);\n        if (!decoded) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/un/login', req.url));\n        return response;\n    }\n    // Reset page requires valid reset token\n    if (isResetPage) {\n        const decoded = await verifyOrClear(resetTokenCookie);\n        if (!decoded) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/un/login', req.url));\n        return response;\n    }\n    // Auth pages\n    if (isAuthPage) {\n        clearCookies(response, [\n            'otp_token',\n            'reset'\n        ]);\n        if (tokenCookie) {\n            const decoded = await verifyOrClear(tokenCookie);\n            if (!decoded) return response; // Just stay on login page after clearing\n            const roles = decoded.payload[ROLE_CLAIM] || [];\n            const role = Array.isArray(roles) ? roles[0] : roles;\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`/${role}/dashboard`, req.url));\n        }\n        return response;\n    }\n    // Protected pages\n    if (isProtectedPage) {\n        const decoded = await verifyOrClear(tokenCookie);\n        if (!decoded) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/un/login', req.url));\n        const roles = decoded.payload[ROLE_CLAIM] || [];\n        const role = Array.isArray(roles) ? roles[0] : roles;\n        if (isConfirmEmailPage) {\n            const isVerified = decoded.payload[VERIFIED_CLAIM];\n            if (isVerified === 'True') {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`/${role}/dashboard`, req.url));\n            }\n            return response;\n        }\n        // Role-based restriction\n        if (pathname.startsWith('/Admin') && role !== 'Admin' || pathname.startsWith('/User') && role !== 'User') {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`/${role}/dashboard`, req.url));\n        }\n        return response;\n    }\n    return response;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QSxrQkFBa0I7SUFDbEIsSUFBSTZDLGlCQUFpQjtRQUNuQixNQUFNRSxVQUFVLE1BQU1ELGNBQWNuQjtRQUNwQyxJQUFJLENBQUNvQixTQUFTLE9BQU81RCxxREFBWUEsQ0FBQ2lELFFBQVEsQ0FBQyxJQUFJQyxJQUFJLGFBQWFkLElBQUllLEdBQUc7UUFFdkUsTUFBTVcsUUFBUUYsUUFBUUcsT0FBTyxDQUFDekQsV0FBVyxJQUFJLEVBQUU7UUFDL0MsTUFBTTBELE9BQU9DLE1BQU1DLE9BQU8sQ0FBQ0osU0FBU0EsS0FBSyxDQUFDLEVBQUUsR0FBR0E7UUFFL0MsSUFBSUwsb0JBQW9CO1lBQ3RCLE1BQU1VLGFBQWFQLFFBQVFHLE9BQU8sQ0FBQ3hELGVBQWU7WUFDbEQsSUFBSTRELGVBQWUsUUFBUTtnQkFDekIsT0FBT25FLHFEQUFZQSxDQUFDaUQsUUFBUSxDQUFDLElBQUlDLElBQUksQ0FBQyxDQUFDLEVBQUVjLEtBQUssVUFBVSxDQUFDLEVBQUU1QixJQUFJZSxHQUFHO1lBQ3BFO1lBQ0EsT0FBT3RDO1FBQ1Q7UUFFQSx5QkFBeUI7UUFDekIsSUFDRSxTQUFVeUMsVUFBVSxDQUFDLGFBQWFVLFNBQVMsV0FDMUMzQixTQUFTaUIsVUFBVSxDQUFDLFlBQVlVLFNBQVMsUUFDMUM7WUFDQSxPQUFPaEUscURBQVlBLENBQUNpRCxRQUFRLENBQUMsSUFBSUMsSUFBSSxDQUFDLENBQUMsRUFBRWMsS0FBSyxVQUFVLENBQUMsRUFBRTVCLElBQUllLEdBQUc7UUFDcEU7UUFFQSxPQUFPdEM7SUFDVDtJQUVBLE9BQU9BO0FBQ1QiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcTW9oYW1hZFxcT25lRHJpdmVcXERlc2t0b3BcXFJ1aGFuX05leHQrYXNwXFxydWhhblxcbWlkZGxld2FyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGp3dFZlcmlmeSB9IGZyb20gJ2pvc2UnO1xyXG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJztcclxuXHJcbi8vIENvbnN0YW50c1xyXG5jb25zdCBKV1RfU0VDUkVUID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVDtcclxuY29uc3QgUk9MRV9DTEFJTSA9ICdodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUnO1xyXG5jb25zdCBWRVJJRklFRF9DTEFJTSA9ICdodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA5LzA5L2lkZW50aXR5L2NsYWltcy9hY3Rvcic7XHJcblxyXG4vLyBGdW5jdGlvbiB0byB2ZXJpZnkgdGhlIEpXVCB0b2tlblxyXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlUb2tlbih0b2tlbikge1xyXG4gIHRyeSB7XHJcbiAgICByZXR1cm4gYXdhaXQgand0VmVyaWZ5KHRva2VuLCBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoSldUX1NFQ1JFVCkpO1xyXG4gIH0gY2F0Y2gge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBGdW5jdGlvbiB0byBjbGVhciBjb29raWVzXHJcbmZ1bmN0aW9uIGNsZWFyQ29va2llcyhyZXNwb25zZSwgY29va2llTmFtZXMpIHtcclxuICBjb29raWVOYW1lcy5mb3JFYWNoKChuYW1lKSA9PlxyXG4gICAgcmVzcG9uc2UuY29va2llcy5zZXQobmFtZSwgJycsIHtcclxuICAgICAgbWF4QWdlOiAwLFxyXG4gICAgICBwYXRoOiAnLycsXHJcbiAgICAgIGh0dHBPbmx5OiB0cnVlLFxyXG4gICAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsIC8vIFNlY3VyZSBpbiBwcm9kdWN0aW9uXHJcbiAgICAgIHNhbWVTaXRlOiAnU3RyaWN0JyxcclxuICAgIH0pXHJcbiAgKTtcclxufVxyXG5cclxuLy8gRnVuY3Rpb24gdG8gZ2VuZXJhdGUgbm9uY2UgZm9yIENTUCAoQ29udGVudCBTZWN1cml0eSBQb2xpY3kpXHJcbmZ1bmN0aW9uIGdlbmVyYXRlTm9uY2UoKSB7XHJcbiAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheSgxNik7XHJcbiAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhhcnJheSk7XHJcbiAgcmV0dXJuIGFycmF5LnRvU3RyaW5nKCdiYXNlNjQnKTtcclxufVxyXG5cclxuLy8gRnVuY3Rpb24gdG8gYXBwbHkgc2VjdXJpdHkgaGVhZGVyc1xyXG5mdW5jdGlvbiBhcHBseVNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSwgbm9uY2UpIHtcclxuICBjb25zdCBjc3AgPSBgXHJcbiAgICBkZWZhdWx0LXNyYyAnc2VsZic7XHJcbiAgICBzY3JpcHQtc3JjICdzZWxmJyAnbm9uY2UtJHtub25jZX0nICd1bnNhZmUtaW5saW5lJztcclxuICAgIHN0eWxlLXNyYyAnc2VsZicgJ3Vuc2FmZS1pbmxpbmUnO1xyXG4gICAgaW1nLXNyYyAnc2VsZicgZGF0YTogYmxvYjo7XHJcbiAgICBmb250LXNyYyAnc2VsZic7XHJcbiAgICBjb25uZWN0LXNyYyAnc2VsZic7XHJcbiAgICBmcmFtZS1hbmNlc3RvcnMgJ25vbmUnO1xyXG4gICAgb2JqZWN0LXNyYyAnbm9uZSc7XHJcbiAgICBiYXNlLXVyaSAnc2VsZic7XHJcbiAgICBmb3JtLWFjdGlvbiAnc2VsZic7XHJcbiAgICB1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzO1xyXG4gIGAucmVwbGFjZSgvXFxzezIsfS9nLCAnICcpLnRyaW0oKTtcclxuXHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0NvbnRlbnQtU2VjdXJpdHktUG9saWN5JywgY3NwKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1Db250ZW50LVR5cGUtT3B0aW9ucycsICdub3NuaWZmJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtRnJhbWUtT3B0aW9ucycsICdERU5ZJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1N0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHknLCAnbWF4LWFnZT02MzA3MjAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQnKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnUmVmZXJyZXItUG9saWN5JywgJ3N0cmljdC1vcmlnaW4td2hlbi1jcm9zcy1vcmlnaW4nKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1YU1MtUHJvdGVjdGlvbicsICcxOyBtb2RlPWJsb2NrJyk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcSkge1xyXG4gIGNvbnN0IHBhdGhuYW1lID0gcmVxLm5leHRVcmwucGF0aG5hbWU7XHJcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKCk7XHJcbiAgY29uc3QgdG9rZW5Db29raWUgPSBjb29raWVTdG9yZS5nZXQoJ3Rva2VuJyk7XHJcbiAgY29uc3Qgb3RwVG9rZW5Db29raWUgPSBjb29raWVTdG9yZS5nZXQoJ290cF90b2tlbicpO1xyXG4gIGNvbnN0IHJlc2V0VG9rZW5Db29raWUgPSBjb29raWVTdG9yZS5nZXQoJ3Jlc2V0Jyk7XHJcblxyXG4gIGNvbnN0IHRva2Vuc1ByZXNlbnQgPSBbdG9rZW5Db29raWUsIG90cFRva2VuQ29va2llLCByZXNldFRva2VuQ29va2llXS5maWx0ZXIoQm9vbGVhbik7XHJcbiAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG5cclxuICAvLyBBZGQgc2VjdXJpdHkgaGVhZGVyc1xyXG4gIGNvbnN0IG5vbmNlID0gZ2VuZXJhdGVOb25jZSgpOyAvLyBHZW5lcmF0ZSBhIG5vbmNlIGZvciB0aGUgQ1NQXHJcbiAgYXBwbHlTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UsIG5vbmNlKTtcclxuXHJcbiAgLy8gSGFuZGxlIG11bHRpcGxlIHRva2VucyAoY2xlYXIgaWYgbW9yZSB0aGFuIG9uZSB0b2tlbiBpcyBwcmVzZW50KVxyXG4gIGlmICh0b2tlbnNQcmVzZW50Lmxlbmd0aCA+IDEpIHtcclxuICAgIGNsZWFyQ29va2llcyhyZXNwb25zZSwgWyd0b2tlbicsICdvdHBfdG9rZW4nLCAncmVzZXQnXSk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy91bi9sb2dpbicsIHJlcS51cmwpKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGlzQXV0aFBhZ2UgPSBbJy91bi9sb2dpbicsICcvdW4vcmVnaXN0ZXInXS5zb21lKChwYXRoKSA9PiBwYXRobmFtZS5zdGFydHNXaXRoKHBhdGgpKTtcclxuICBjb25zdCBpc090cFBhZ2UgPSBwYXRobmFtZS5zdGFydHNXaXRoKCcvdW4vb3RwVmFsaWRhdGVQYXNzd29yZCcpO1xyXG4gIGNvbnN0IGlzUmVzZXRQYWdlID0gcGF0aG5hbWUuc3RhcnRzV2l0aCgnL3VuL3Jlc2V0UGFzc3dvcmQnKTtcclxuICBjb25zdCBpc0NvbmZpcm1FbWFpbFBhZ2UgPSBwYXRobmFtZS5zdGFydHNXaXRoKCcvVXNlci9WZXJpZnlFbWFpbCcpO1xyXG4gIGNvbnN0IGlzUHJvdGVjdGVkUGFnZSA9IHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9Vc2VyJykgfHwgcGF0aG5hbWUuc3RhcnRzV2l0aCgnL0FkbWluJyk7XHJcblxyXG4gIGFzeW5jIGZ1bmN0aW9uIHZlcmlmeU9yQ2xlYXIodG9rZW5Db29raWUpIHtcclxuICAgIGlmICghdG9rZW5Db29raWUpIHJldHVybiBudWxsO1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHZlcmlmeVRva2VuKHRva2VuQ29va2llLnZhbHVlKTtcclxuICAgIGlmICghZGVjb2RlZCkge1xyXG4gICAgICBjbGVhckNvb2tpZXMocmVzcG9uc2UsIFsndG9rZW4nLCAnb3RwX3Rva2VuJywgJ3Jlc2V0J10pO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHJldHVybiBkZWNvZGVkO1xyXG4gIH1cclxuXHJcbiAgLy8gT1RQIHBhZ2UgcmVxdWlyZXMgdmFsaWQgb3RwX3Rva2VuXHJcbiAgaWYgKGlzT3RwUGFnZSkge1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHZlcmlmeU9yQ2xlYXIob3RwVG9rZW5Db29raWUpO1xyXG4gICAgaWYgKCFkZWNvZGVkKSByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy91bi9sb2dpbicsIHJlcS51cmwpKTtcclxuICAgIHJldHVybiByZXNwb25zZTtcclxuICB9XHJcblxyXG4gIC8vIFJlc2V0IHBhZ2UgcmVxdWlyZXMgdmFsaWQgcmVzZXQgdG9rZW5cclxuICBpZiAoaXNSZXNldFBhZ2UpIHtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBhd2FpdCB2ZXJpZnlPckNsZWFyKHJlc2V0VG9rZW5Db29raWUpO1xyXG4gICAgaWYgKCFkZWNvZGVkKSByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy91bi9sb2dpbicsIHJlcS51cmwpKTtcclxuICAgIHJldHVybiByZXNwb25zZTtcclxuICB9XHJcblxyXG4gIC8vIEF1dGggcGFnZXNcclxuICBpZiAoaXNBdXRoUGFnZSkge1xyXG4gICAgY2xlYXJDb29raWVzKHJlc3BvbnNlLCBbJ290cF90b2tlbicsICdyZXNldCddKTtcclxuICAgIGlmICh0b2tlbkNvb2tpZSkge1xyXG4gICAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgdmVyaWZ5T3JDbGVhcih0b2tlbkNvb2tpZSk7XHJcbiAgICAgIGlmICghZGVjb2RlZCkgcmV0dXJuIHJlc3BvbnNlOyAvLyBKdXN0IHN0YXkgb24gbG9naW4gcGFnZSBhZnRlciBjbGVhcmluZ1xyXG4gICAgICBjb25zdCByb2xlcyA9IGRlY29kZWQucGF5bG9hZFtST0xFX0NMQUlNXSB8fCBbXTtcclxuICAgICAgY29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkocm9sZXMpID8gcm9sZXNbMF0gOiByb2xlcztcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKGAvJHtyb2xlfS9kYXNoYm9hcmRgLCByZXEudXJsKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICAvLyBQcm90ZWN0ZWQgcGFnZXNcclxuICBpZiAoaXNQcm90ZWN0ZWRQYWdlKSB7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgdmVyaWZ5T3JDbGVhcih0b2tlbkNvb2tpZSk7XHJcbiAgICBpZiAoIWRlY29kZWQpIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL3VuL2xvZ2luJywgcmVxLnVybCkpO1xyXG5cclxuICAgIGNvbnN0IHJvbGVzID0gZGVjb2RlZC5wYXlsb2FkW1JPTEVfQ0xBSU1dIHx8IFtdO1xyXG4gICAgY29uc3Qgcm9sZSA9IEFycmF5LmlzQXJyYXkocm9sZXMpID8gcm9sZXNbMF0gOiByb2xlcztcclxuXHJcbiAgICBpZiAoaXNDb25maXJtRW1haWxQYWdlKSB7XHJcbiAgICAgIGNvbnN0IGlzVmVyaWZpZWQgPSBkZWNvZGVkLnBheWxvYWRbVkVSSUZJRURfQ0xBSU1dO1xyXG4gICAgICBpZiAoaXNWZXJpZmllZCA9PT0gJ1RydWUnKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKGAvJHtyb2xlfS9kYXNoYm9hcmRgLCByZXEudXJsKSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJvbGUtYmFzZWQgcmVzdHJpY3Rpb25cclxuICAgIGlmIChcclxuICAgICAgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9BZG1pbicpICYmIHJvbGUgIT09ICdBZG1pbicpIHx8XHJcbiAgICAgIChwYXRobmFtZS5zdGFydHNXaXRoKCcvVXNlcicpICYmIHJvbGUgIT09ICdVc2VyJylcclxuICAgICkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoYC8ke3JvbGV9L2Rhc2hib2FyZGAsIHJlcS51cmwpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzcG9uc2U7XHJcbn1cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImp3dFZlcmlmeSIsImNvb2tpZXMiLCJKV1RfU0VDUkVUIiwicHJvY2VzcyIsImVudiIsIlJPTEVfQ0xBSU0iLCJWRVJJRklFRF9DTEFJTSIsInZlcmlmeVRva2VuIiwidG9rZW4iLCJUZXh0RW5jb2RlciIsImVuY29kZSIsImNsZWFyQ29va2llcyIsInJlc3BvbnNlIiwiY29va2llTmFtZXMiLCJmb3JFYWNoIiwibmFtZSIsInNldCIsIm1heEFnZSIsInBhdGgiLCJodHRwT25seSIsInNlY3VyZSIsInNhbWVTaXRlIiwiZ2VuZXJhdGVOb25jZSIsImFycmF5IiwiVWludDhBcnJheSIsImNyeXB0byIsImdldFJhbmRvbVZhbHVlcyIsInRvU3RyaW5nIiwiYXBwbHlTZWN1cml0eUhlYWRlcnMiLCJub25jZSIsImNzcCIsInJlcGxhY2UiLCJ0cmltIiwiaGVhZGVycyIsIm1pZGRsZXdhcmUiLCJyZXEiLCJwYXRobmFtZSIsIm5leHRVcmwiLCJjb29raWVTdG9yZSIsInRva2VuQ29va2llIiwiZ2V0Iiwib3RwVG9rZW5Db29raWUiLCJyZXNldFRva2VuQ29va2llIiwidG9rZW5zUHJlc2VudCIsImZpbHRlciIsIkJvb2xlYW4iLCJuZXh0IiwibGVuZ3RoIiwicmVkaXJlY3QiLCJVUkwiLCJ1cmwiLCJpc0F1dGhQYWdlIiwic29tZSIsInN0YXJ0c1dpdGgiLCJpc090cFBhZ2UiLCJpc1Jlc2V0UGFnZSIsImlzQ29uZmlybUVtYWlsUGFnZSIsImlzUHJvdGVjdGVkUGFnZSIsInZlcmlmeU9yQ2xlYXIiLCJkZWNvZGVkIiwidmFsdWUiLCJyb2xlcyIsInBheWxvYWQiLCJyb2xlIiwiQXJyYXkiLCJpc0FycmF5IiwiaXNWZXJpZmllZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./middleware.js\n");

/***/ })

});